{{ define "admin_login" }}
<!DOCTYPE html>
<html lang="fr">
<head>
    {{ template "head" . }}
    <style>
        {{.theme | safeCSS}}
    </style>
    <link rel="stylesheet" href="/files/css/common.css?{{ .BuildID }}">
    <link rel="stylesheet" href="/files/css/login.css?{{ .BuildID }}">
</head>
<body>
    {{ template "admin_login_content" . }}
    {{ template "admin_login_scripts" . }}
</body>
</html>
{{ end }}
{{ define "admin_login_content" }}
    <div class="bg-shapes">
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
        <div class="shape"></div>
    </div>

    <div class="login-container">
        <div class="login-header">
            <div class="login-icon"><img src="/files/img/locked.svg" class="icon"></div>
            <h1 class="login-title">Administration</h1>
            <p class="login-subtitle">Connexion sécurisée requise</p>
        </div>

        <form x-data="loginForm" @submit.prevent="login">
            <div x-show="error" class="alert alert-error" x-text="error"></div>

            <div class="form-group">
                <label class="form-label" for="username"><img src="/files/img/bust.svg" class="icon"> Nom d'utilisateur</label>
                <input x-model="credentials.username" 
                       id="username" 
                       type="text" 
                       class="form-control"
                       placeholder="Entrez votre nom d'utilisateur"
                       required
                       autocomplete="username">
            </div>

            <div class="form-group">
                <label class="form-label" for="password"><img src="/files/img/key.svg" class="icon"> Mot de passe</label>
                <input x-model="credentials.password" 
                       id="password" 
                       type="password" 
                       class="form-control"
                       placeholder="Entrez votre mot de passe"
                       required
                       autocomplete="current-password">
            </div>

            <button type="submit" 
                    :disabled="loading" 
                    class="btn btn-primary">
                <span x-show="!loading"><img src="/files/img/rocket.svg" class="icon"> Se connecter</span>
                <span x-show="loading"><img src="/files/img/hourglass.svg" class="icon"> Connexion en cours...</span>
            </button>
        </form>
        <a href="/" class="back-link">← Retour au blog</a>
    </div>
{{ end }}
{{ define "admin_login_scripts" }}
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('loginForm', () => ({
                credentials: {
                    username: '',
                    password: ''
                },
                loading: false,
                error: '',

                async login() {
                    this.loading = true;
                    this.error = '';

                    try {
                        const response = await fetch('/admin/login', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.credentials)
                        });

                        const data = await response.json();

                        if (response.ok) {
                            window.location.href = data.redirect || '/admin';
                        } else {
                            this.error = data.error || 'Erreur de connexion';
                        }
                    } catch (error) {
                        console.error('Erreur:', error);
                        this.error = 'Erreur de connexion au serveur';
                    } finally {
                        this.loading = false;
                    }
                }
            }));
        });
    </script>
{{ end }}