{{ define "admin_posts" }}
<!DOCTYPE html>
<html lang="fr">
<head>
    {{ template "head" . }}
    <style>
        {{.theme | safeCSS}}
    </style>
    <link rel="stylesheet" href="/files/css/admin_header.css?{{ .BuildID }}">
    <link rel="stylesheet" href="/files/css/common.css?{{ .BuildID }}">
    <link rel="stylesheet" href="/files/css/footer.css?{{ .BuildID }}">
    <link rel="stylesheet" href="/files/css/admin_posts.css?{{ .BuildID }}">
</head>
<body>
    {{ template "admin_header" . }}
    <main class="main">
        {{ template "admin_posts_content" . }}
    </main>
    {{ template "footer" . }}
    <script src="/files/js/admin_posts.js?{{ .BuildID }}"></script>
    <script src="/files/js/common.js?{{ .BuildID }}"></script>
</body>
</html>
{{ end }}
{{ define "admin_posts_content" }}
<div class="container">
    <div class="page-header">
        <h1 class="page-title"><img src="/files/img/books.svg" class="icon"> Gestion des Articles</h1>
        <a href="/admin/posts/new" class="btn btn-success">
            <img src="/files/img/plus.svg" class="icon"> Nouvel Article
        </a>
    </div>

    <div x-data="postsManager">
        {{- if .posts }}
        <div class="posts-container">
            <div class="posts-header">
                <div class="posts-count">
                    <img src="/files/img/stats.svg" class="icon"> <strong>{{ len .posts }}</strong> article{{ if gt (len .posts) 1 }}s{{ end }} total{{ if gt (len .posts) 1 }}aux{{ end }}
                </div>
                <div style="font-size: 0.9em; color: #666;">
                    Dernière mise à jour il y a quelques instants
                </div>
            </div>

            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width: 40%;"><img src="/files/img/memo.svg" class="icon"> Article</th>
                            <th style="width: 15%;"><img src="/files/img/bust.svg" class="icon"> Auteur</th>
                            <th style="width: 15%;"><img src="/files/img/calendar.svg" class="icon"> Date</th>
                            <th style="width: 15%;"><img src="/files/img/label.svg" class="icon"> Tags</th>
                            <th style="width: 10%;"><img src="/files/img/stats.svg" class="icon"> Stats</th>
                            <th style="width: 25%;"><img src="/files/img/gear.svg" class="icon"> Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{- range .posts }}
                        <tr>
                            <td>
                                <div class="post-title">{{ .Title }}</div>
                                <div class="post-excerpt">{{ .Excerpt }}</div>
                            </td>
                            <td>
                                <strong>{{ .Author }}</strong>
                            </td>
                            <td>
                                <div>{{ .CreatedAt.Format "02/01/2006" }}</div>
                                <div style="font-size: 0.8em; color: #666;">{{ .CreatedAt.Format "15:04" }}</div>
                            </td>
                            <td>
                                <div class="post-tags">
                                    {{- range .TagsList }}
                                    <span class="tag">{{ . }}</span>
                                    {{- end }}
                                </div>
                            </td>
                            <td>
                                <div class="stats-cell">
                                    <div class="stat"><img src="/files/img/ballon.svg" class="icon"> {{ len .Comments }}</div>
                                </div>
                            </td>
                            <td>
                                <div class="actions">
                                    <a href="/post/{{ .ID }}" class="btn btn-primary btn-sm" target="_blank" title="Voir l'article">
                                        <img src="/files/img/eye.svg" class="icon">
                                    </a>
                                    <a href="/admin/posts/{{ .ID }}/edit" class="btn btn-warning btn-sm" title="Éditer">
                                        <img src="/files/img/pencil.svg" class="icon">
                                    </a>
                                    <button @click="confirmDelete({{ .ID }}, '{{ .Title | escapeJS}}')" class="btn btn-danger btn-sm" title="Supprimer"><img src="/files/img/waste.svg" class="icon"></button>
                                </div>
                            </td>
                        </tr>
                        {{- end }}
                    </tbody>
                </table>
            </div>
        </div>
        {{- else }}
        <div class="posts-container">
            <div class="empty-state">
                <div class="empty-icon"><img src="/files/img/memo.svg" class="icon"></div>
                <h3 class="empty-title">Aucun article pour le moment</h3>
                <p class="empty-description">Commencez par créer votre premier article pour partager vos idées !</p>
                <a href="/admin/posts/new" class="btn btn-success btn-lg">
                    <img src="/files/img/plus.svg" class="icon"> Créer le premier article
                </a>
            </div>
        </div>
        {{- end }}

        <!-- Modal de confirmation -->
        <div x-show="showDeleteModal" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             class="modal-overlay" 
             @click.self="showDeleteModal = false">
            <div class="modal"
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform scale-95"
                 x-transition:enter-end="opacity-100 transform scale-100">
                <div class="modal-icon"><img src="/files/img/waste.svg" class="icon"></div>
                <h3 class="modal-title">Confirmer la suppression</h3>
                <div class="modal-content">
                    <p>Êtes-vous absolument sûr de vouloir supprimer cet article ?</p>
                    <div class="modal-target" x-text="deleteTarget.title"></div>
                    <div class="modal-warning">
                        <img src="/files/img/warning.svg" class="icon"> Cette action est <strong>irréversible</strong> !<br>
                        Tous les commentaires seront également supprimés.
                    </div>
                </div>
                <div class="modal-actions">
                    <button @click="showDeleteModal = false" class="btn btn-primary">
                        <img src="/files/img/cross.svg" class="icon"> Annuler
                    </button>
                    <button @click="deletePost" 
                            :disabled="deleting" 
                            class="btn btn-danger">
                        <span x-show="!deleting"><img src="/files/img/waste.svg" class="icon"> Supprimer définitivement</span>
                        <span x-show="deleting"><img src="/files/img/hourglass.svg" class="icon"> Suppression...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{{ end }}